<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello blog</title>
      <link href="/2024/01/21/5.%20InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84/"/>
      <url>/2024/01/21/5.%20InnoDB%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="数据页结构"><a href="#数据页结构" class="headerlink" title="数据页结构"></a>数据页结构</h1><p>数据页大小一般为 16KB。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700102144698-9e521ae2-6223-4468-8da7-8b5e3f1f78fe.png#averageHue=%23d19e41&clientId=ue4f6f3bf-827e-4&from=paste&height=313&id=ua85ac9a2&originHeight=783&originWidth=750&originalType=binary&ratio=2&rotation=0&showTitle=false&size=155926&status=done&style=none&taskId=u247d4e71-80b0-4d18-9eb3-0f669c7bd95&title=&width=300" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700102221586-ae8ddd99-7c69-422f-8d8b-1086284b4335.png#averageHue=%23e7e1d9&clientId=ue4f6f3bf-827e-4&from=paste&height=300&id=u870f67bf&originHeight=351&originWidth=819&originalType=binary&ratio=2&rotation=0&showTitle=false&size=169389&status=done&style=none&taskId=uafdc73c5-0a02-4efe-9935-ef6e3c922ce&title=&width=700" alt="image.png"></p><h1 id="单条记录的记录头"><a href="#单条记录的记录头" class="headerlink" title="单条记录的记录头"></a>单条记录的记录头</h1><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700102317982-874c714b-7f6f-451b-b915-6fbc5a4d90d2.png#averageHue=%23fbf7f4&clientId=ue4f6f3bf-827e-4&from=paste&height=311&id=u58e923b7&originHeight=466&originWidth=1049&originalType=binary&ratio=2&rotation=0&showTitle=false&size=82907&status=done&style=none&taskId=ucc852ef6-cc44-4fbf-a9aa-5841b577b3b&title=&width=700" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700102345795-f9ff820b-0b94-485e-83f5-aaf53484d64a.png#averageHue=%23f9f9f8&clientId=ue4f6f3bf-827e-4&from=paste&height=275&id=u11bfcf24&originHeight=442&originWidth=1126&originalType=binary&ratio=2&rotation=0&showTitle=false&size=101276&status=done&style=none&taskId=u9b29b8f0-bb7a-4c43-815e-291fd67c309&title=&width=700" alt="image.png"></p><h3 id="delete-mask"><a href="#delete-mask" class="headerlink" title="delete_mask"></a>delete_mask</h3><p>标记该记录是否被删除<strong>。</strong>1 &#x3D; 删除。被删除的记录<strong>不是立即从磁盘移除</strong>，因为重新排列新顺序<strong>需要性能消耗。</strong>被删掉的记录会组成<strong>垃圾链表</strong>，这些链表组成空间叫做<strong>可重用空间</strong>，之后<strong>新数据可插入到这</strong>。<br>删除的过程如下：</p><ul><li>delete_mask 值设 0。</li><li>next_record 值设 0。</li><li>被删除记录的<strong>上一条指向下一条</strong>。</li><li><strong>最大记录</strong>的 n_owned 值减 1。</li></ul><h3 id="min-rec-mask"><a href="#min-rec-mask" class="headerlink" title="min_rec_mask"></a>min_rec_mask</h3><p>B+树的每层<strong>非叶子节点</strong>中的<strong>最小记录</strong>都会添加该标记。</p><h3 id="n-owned"><a href="#n-owned" class="headerlink" title="n_owned"></a>n_owned</h3><p>该组内有多少条记录，每个组的<strong>最后一条记录</strong>中存在（组内最大）。<br>Page Directory 中的<strong>槽</strong>指向每组中的最后一条记录，这条记录中有 n_owned。</p><h3 id="heap-no"><a href="#heap-no" class="headerlink" title="heap_no"></a>heap_no</h3><p>当前记录在<strong>本页的位置。</strong><br><strong>heap_no &#x3D;&#x3D; 0 or 1 <strong>分别表示</strong>最小记录和最大记录</strong>（也称为<strong>伪记录或虚拟记录</strong>）（记录比较大小即比较<strong>主键的大小</strong>），固定大小** 5B 记录头+8B 数据。<strong>其中最小记录数据为 <strong>infimum</strong> ，最大记录数据为 <strong>supremum</strong>。<br>最小记录和最大记录</strong>不存放<strong>在 User Records 部分，</strong>单独放在** Infimum+Supremum 部分。<br>infimum 指比本页中任何记录都要小，supremum 指本页中比任何记录都要大。<br>通过** infimum 和 supremum **对应的两个槽（Page Directory 中），找到一页中的最小值和最大值（infimum 位置 + 1 为最小值，supremum 位置 - 1 为最大值）。</p><h3 id="record-type"><a href="#record-type" class="headerlink" title="record_type"></a>record_type</h3><p>记录当前记录类型，0 &#x3D; 普通记录，1 &#x3D; B+树非叶节点，2 &#x3D; 最小记录 Infimum，3 &#x3D; 最大记录 Supremum。</p><h3 id="next-record"><a href="#next-record" class="headerlink" title="next_record"></a>next_record</h3><p>从当前记录的真实数据到下一条记录真实数据的偏移量。即 <strong>记录 1 + next_record &#x3D; 记录 2</strong>，本质是一个<strong>链表</strong>，next_record 指向下一条记录。<br>下一条记录指<strong>按照主键值从小到大</strong>的顺序，规定** Infimum 指向主键值最小<strong>的用户记录，</strong>主键值最大的用户数据指向 Supremum<strong>。<br>next_record 指向</strong>真实数据开头<strong>，指向</strong>记录头结尾<strong>（记录头按</strong>逆序**存放）<br><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700103768843-fc6c3973-41f4-47f3-ae4b-3d47e60b2621.png#averageHue=%23f3e0cc&clientId=ue4f6f3bf-827e-4&from=paste&height=350&id=u2eaa8a44&originHeight=487&originWidth=975&originalType=binary&ratio=2&rotation=0&showTitle=false&size=253063&status=done&style=none&taskId=ufb774ede-efbe-42fd-a4b0-f8a3a96de9d&title=&width=700" alt="image.png"></p><h1 id="Page-Directory-页目录"><a href="#Page-Directory-页目录" class="headerlink" title="Page Directory 页目录"></a>Page Directory 页目录</h1><p>为<strong>查找更快</strong>，设置页目录，<strong>大小不确定</strong>。</p><h2 id="页目录制作"><a href="#页目录制作" class="headerlink" title="页目录制作"></a>页目录制作</h2><ol><li>将所有正常记录（含 Infimum 和 Supremum，不含被删除的）划分为<strong>组。</strong></li><li>每个组<strong>最后一条记录（组内最大）</strong> n_owned 表示组有多少条记录。</li><li>将<strong>槽</strong>（<strong>组最后一条记录的地址偏移量</strong>）按顺序放到** Page Directory（页目录） **里。</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700104471100-86143d88-e072-4282-8c57-6cb57163c2b6.png#averageHue=%23f8f1ea&clientId=ue4f6f3bf-827e-4&from=paste&height=382&id=ud59dea2a&originHeight=870&originWidth=1596&originalType=binary&ratio=2&rotation=0&showTitle=false&size=235355&status=done&style=none&taskId=u7abb2a50-5076-4634-bbb8-311fb60762e&title=&width=700" alt="image.png"></p><h2 id="分组划分"><a href="#分组划分" class="headerlink" title="分组划分"></a>分组划分</h2><p>划分规则：1）<strong>最小记录</strong>所在组只能有** 1 条<strong>记录。2）</strong>最大记录<strong>所在组含</strong> 1～8 条<strong>。3）</strong>剩下**分组含 <strong>4～8</strong> 条。</p><ol><li>初始页里只有 Infimum 和 Supremum，它们<strong>分属两个分组</strong>。</li><li>插入记录，根据主键值找<strong>比本记录大&amp;&amp;差值最小</strong>的槽。</li><li>该<strong>槽 o_wned 值加 1</strong>，将记录添加到组中。</li><li>当组记录数到 8 时，拆分成两个组，<strong>一个组 4 条，一个组 5 条</strong>。</li><li><strong>新增一个槽</strong>，记录新分组中最大记录偏移量。</li></ol><h2 id="分组查找"><a href="#分组查找" class="headerlink" title="分组查找"></a>分组查找</h2><ol><li>通过<strong>二分法</strong>确定该记录所在槽，并<strong>找到该槽中的最小值</strong>。二分法条件为 high - low &gt; 1 ，因此一般找到的槽为<strong>记录所在槽的前一个</strong>，再 +1 即可找到记录所在槽。</li><li>通过 next_record 属性<strong>遍历</strong>整个槽，找到目标值。</li></ol><h1 id="Page-Header-页面头部"><a href="#Page-Header-页面头部" class="headerlink" title="Page Header 页面头部"></a>Page Header 页面头部</h1><p>数据页中存储记录的<strong>状态信息</strong>，<strong>固定 56B</strong>。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700116283402-da81e487-71ae-4f2b-bf42-0ec397d0f1ea.png#averageHue=%23f7f6f5&clientId=ue4f6f3bf-827e-4&from=paste&height=456&id=u98789a28&originHeight=830&originWidth=1273&originalType=binary&ratio=2&rotation=0&showTitle=false&size=286873&status=done&style=none&taskId=u5ab341da-c74f-435a-8da0-0e0e65edeb2&title=&width=700" alt="image.png"></p><h1 id="File-Header-文件头"><a href="#File-Header-文件头" class="headerlink" title="File Header 文件头"></a>File Header 文件头</h1><p>针对<strong>各种页都通用</strong>的信息，<strong>固定 38B</strong>。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/21645180/1700116380750-113b6a77-0b8b-4653-8124-337776fc627c.png#averageHue=%23ede9e4&clientId=ue4f6f3bf-827e-4&from=paste&height=303&id=u2f484d54&originHeight=534&originWidth=1234&originalType=binary&ratio=2&rotation=0&showTitle=false&size=272149&status=done&style=none&taskId=ue6837071-eadd-453e-b46c-8a8cad77fba&title=&width=700" alt="image.png"></p><ul><li>FIL_PAGE_PREV 和 FIL_PAGE_NEXT 为指向上一页和下一页的两个链表。（<strong>双向链表</strong>）</li></ul><h1 id="File-Trailer"><a href="#File-Trailer" class="headerlink" title="File Trailer"></a>File Trailer</h1><p>用于<strong>校验页是否完整</strong>，防止只同步一半的情况发生，<strong>固定 8B</strong>。</p><ul><li>前 4B 表示页的<strong>校验和</strong>。</li><li>后 4B 表示页面最后修改时对应的日志序列位置（<strong>LSN</strong>）。</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello blog</title>
      <link href="/2024/01/20/Hello-blog/"/>
      <url>/2024/01/20/Hello-blog/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2024/01/20/hello-world/"/>
      <url>/2024/01/20/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
